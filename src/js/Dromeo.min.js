/**
*
*   Dromeo
*   Simple and Flexible Pattern Routing Framework for PHP, JavaScript, Python
*   @version: 1.1.2
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t],e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}("undefined"!=typeof self?self:this,"Dromeo",function(){"use strict";var T=/^([^|]+\|.+)$/,b=/\((\d+)\)$/,t=/^\s+|\s+$/g,n=/([*+\[\]\(\)?^$\/\\:.])/g,e="prototype",r=Object[e],o=(Array[e],Function[e],r.toString),E=r.hasOwnProperty,l="undefined"!=typeof global&&"[object global]"==o.call(global),v=String[e].trim?function(e){return e.trim()}:function(e){return e.replace(t,"")},i={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},a=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"];function A(e){return 0<e.length}function k(e){return e.replace(n,"\\$1")}function y(e){return"[object Array]"===o.call(e)}function P(e){return"[object Object]"===o.call(e)&&"function"==typeof e.constructor&&"Object"===e.constructor.name}function R(e){return"string"==typeof e||"[object String]"===o.call(e)}function m(e){return"function"==typeof e}function S(e,t,n){var r,l,u;if(n=!0===n,t)for(r in t)E.call(t,r)&&(l=t[r],"number"==typeof(u=l)||"[object Number]"===o.call(u)?e[r]=0+l:R(l)?e[r]=l.slice():y(l)?e[r]=n?S(new Array(l.length),l,n):l:P(l)?e[r]=n?S({},l,n):l:e[r]=l);return e}function j(e){return decodeURIComponent(String(e))}function s(e){return encodeURIComponent(String(e)).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")}function f(e){return s(e).split("%20").join("+")}function u(e){for(var t,n,r,l,u,o,i,a,s,f,c,p,h=e.replace(/^&+|&+$/g,"").split("&"),d=h.length,g={},m=[],_=0;_<d;++_)if(o=h[_].split("="),u=j(v(o[0])),o=o.length<2?"":j(v(o[1])),-1<(t=u.indexOf("\0"))&&(u=u.slice(0,t)),u&&"["!==u.charAt(0)){for(a=[],t=i=0;t<u.length;++t)if("["!==u.charAt(t)||i){if("]"===u.charAt(t)&&i&&(a.length||a.push(u.slice(0,i-1)),a.push(u.substr(i,t-i)),i=0,"["!==u.charAt(t+1)))break}else i=t+1;for(a.length||(a=[u]),t=0;t<a[0].length&&(" "!==(l=a[0].charAt(t))&&"."!==l&&"["!==l||(a[0]=a[0].substr(0,t)+"_"+a[0].substr(t+1)),"["!==l);++t);for(u=null,n=r=g,f=a.length?v(a[a.length-1].replace(/^['"]|['"]$/g,"")):null,t=0,s=a.length;t<s;++t)c=u,u=a[t].replace(/^['"]|['"]$/g,""),p=n,n=r,""!==v(u)||0===t?(E.call(r,u)||(r[u]=t+1===s-1&&""===f?[]:{}),r=r[u]):u=!0;!0===u?n.push(o):(u==+u&&m.push({key:c,obj:p}),n[u]=o)}for(_=m.length-1;0<=_;--_)(function(e){if(y(e))return!0;if(P(e)){var t,n=function(e){if("function"==typeof Object.keys)return Object.keys(e);var t,n,r;if(y(e))for(t=new Array(r=e.length),n=0;n<r;++n)t[n]=String(n);else for(n in t=[],e)E.call(e,n)&&t.push(n);return t}(e),r=n.length;for(t=0;t<r;++t)if(t!==+n[t])return!1;return!0}return!1})(r=m[_].key?m[_].obj[m[_].key]:m[_].obj)&&(r=function(e){if(y(e))return e;if("function"==typeof Object.values)return Object.values(e);var t,n=[];for(t in e)E.call(e,t)&&n.push(e[t]);return n}(r),m[_].key?m[_].obj[m[_].key]=r:g=r);return g}function c(e,t,n){var r,l=t.length;if(!0===n)return 0<l&&-1!==t.indexOf(e);for(r=0;r<l;++r)if(e==t[r])return 1}function p(e,t,n){var r,l,u=[];for(r in arguments.length<2&&(t="&"),arguments.length<3&&(n=!1),e)E.call(e,r)&&""!=(l=function e(t,n,r,l){var u,o,i=l?s:f;if(!0===n?n="1":!1===n&&(n="0"),null==n)return"";if("object"!=typeof n)return i(t)+"="+i(n);for(u in o=[],n)E.call(n,u)&&null!=n[u]&&o.push(e(t+"["+u+"]",n[u],r,l));return o.join(r)}(r,e[r],t,n))&&u.push(l);return u.join(t)}function N(e,t,n){if(t!==n&&n){var r,l,u=[];for(e=e.split(t),l=0;l<e.length;++l)r=(r=e[l]).split(n),u.push(r[0]),1<r.length&&u.push(r[1]);return u}return e.split(t)}function h(e,t,n,r,l){var u,o,i,a,s,f,c,p,h,d,g,m,_,y,P,R,S;if(n.indexOf(e[0])<0)return[n,l&&l.length?l+n:n,{},r,!0,[n]];for(a=(u=N(n,e[0],e[1])).length,c=!1,p="",d=S=0,m={},R=[],l&&l.length&&(p+=k(l),S=l.length),i=0;i<a;++i)o=u[i],c?(f=s=!1,g=null,(h=o.split(e[4]))[0].length||(h[0]=e[2]+"PART"+e[3]),y=function(e,t,n){for(var r,l,u=0,o={},i=[],a=[],s=null,f=(n=N(n,e[2],e[3])).length,c=!1,p=0;p<f;++p)c=c?(n[p].length&&(E.call(t,n[p])?(i.push("("+t[n[p]][0]+")"),++u,t[n[p]][1]&&(o[u]=t[n[p]][1]),null==s&&(s=i[i.length-1])):(r=n[p].match(T))?(i.push("("+r[1].split("|").filter(A).map(k).join("|")+")"),++u,null==s&&(s=i[i.length-1])):n[p].length&&(i.push("("+k(n[p])+")"),++u,null==s&&(s=i[i.length-1]))),a.push(!0),!1):(n[p].length&&(i.push(k(n[p])),a.push(n[p])),!0);return 1===i.length&&1===u?(o[0]=o[1]?o[1]:null,[l=i.join(""),u,o,a,s||l]):(o[0]=null,[l="("+i.join("")+")",u+1,o,a,s||l])}(e,t,h[0]),1<h.length&&((s=(_=v(h[1])).length&&"?"===_.charAt(0))&&(_=_.slice(1)),(h=_.match(b))?(_=_.slice(0,-h[0].length),P=parseInt(h[1],10),g=E.call(y[2],P)?y[2][P]:null,0<=P&&P<y[1]?P+=d+1:P=d+1):(g=y[2][0]?y[2][0]:null,P=d+1),f=0<_.length),p+=y[0],d+=y[1],s&&(p+="?"),f&&(m[_]=[P,g,S]),f&&R.push({name:_,optional:s,re:new RegExp("^"+y[4]+"$"),tpl:y[3]}),c=!1,S=0):(p+=k(o),S+=o.length,R.push(o),c=!0);return[n,new RegExp("^"+p+"$"),m,r,!1,R]}function _(e,t){return t.join(",")+"->"+e}function x(e){return c("*",e=e?e.map?e.map(function(e){return e.toLowerCase()}):[String(e).toLowerCase()]:["*"])&&(e=["*"]),e.sort(),e}function d(e,t,n){for(var r=e.length-1;0<=r;--r)n===e[r].key&&(route.name&&E.call(t,route.name)&&delete t[route.name],e[r].dispose(),e.splice(r,1))}function g(e,t,n,r,l,u,o){var i;for(o=!!o,i=0;i<u.length;++i)!function(e,t,n,r,l,u,o){if(u&&R(u.route)&&u.route.length&&u.handler&&m(u.handler)){o=!0===o;for(var i=u.handler,a=u.defaults||{},s=u.types||null,f=u.name||null,c=x(u.method),p=_(u=u.route,c),h=null,d=0,g=e.length;d<g;++d)if(p===e[d].key){h=e[d];break}h||(h=new C(n,r,u,c,f,l),e.push(h),h.name&&h.name.length&&(t[h.name]=h)),h.handlers.push([i,a,s,o,0])}}(e,t,n,r,l,u[i],o)}function C(e,t,n,r,l,u){var o=this;o.__args__=[e,t],o.isParsed=!1,o.handlers=[],o.route=null!=n?String(n):"",o.prefix=null!=u?String(u):"",o.method=r,o.pattern=null,o.captures=null,o.literal=!1,o.namespace=null,o.tpl=null,o.name=null!=l?String(l):null,o.key=_(o.route,o.method)}function w(e){var t=this;if(!(t instanceof w))return new w(e);t._delims=["{","}","%","%",":"],t._patterns={},t.definePattern("ALPHA","[a-zA-Z\\-_]+"),t.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),t.definePattern("NUMBR","[0-9]+"),t.definePattern("INT","[0-9]+","INT"),t.definePattern("PART","[^\\/?#]+"),t.definePattern("VAR","[^=?&#\\/]+","VAR"),t.definePattern("QUERY","\\?[^?#]+"),t.definePattern("FRAGMENT","#[^?#]+"),t.definePattern("URLENCODED","[^\\/?#]+","URLENCODED"),t.definePattern("ALL",".+"),t._routes=[],t._named_routes={},t._fallback=!1,t._prefix=null!=e?String(e):""}return C.to_key=_,C[e]={constructor:C,__args__:null,isParsed:!1,handlers:null,route:null,prefix:null,pattern:null,captures:null,tpl:null,method:null,literal:null,namespace:null,name:null,key:null,dispose:function(){var e=this;return e.__args__=null,e.isParsed=null,e.handlers=null,e.route=null,e.prefix=null,e.pattern=null,e.captures=null,e.tpl=null,e.method=null,e.literal=null,e.namespace=null,e.name=null,e.key=null,e},parse:function(){var e=this;if(e.isParsed)return e;var t=h(e.__args__[0],e.__args__[1],e.route,e.method,e.prefix);return e.pattern=t[1],e.captures=t[2],e.tpl=t[5],e.literal=!0===t[4],e.__args__=null,e.isParsed=!0,e},match:function(e,t){var n=this;return c(t=t||"*",n.method)||"*"===n.method[0]?(n.isParsed||n.parse(),e=String(e),n.literal?e===n.pattern?[]:null:e.match(n.pattern)):null},make:function(e,t){var n,r,l,u,o,i,a,s=this,f="";for(e=e||{},t=!0===t,s.isParsed||s.parse(),n=0,r=(a=s.tpl).length;n<r;++n)if(R(a[n]))f+=a[n];else if(E.call(e,a[n].name)&&null!=e[a[n].name]){if(o=String(e[a[n].name]),t&&!a[n].re.test(o))throw new ReferenceError('Dromeo: Route "'+s.name+'" (Pattern: "'+s.route+'") parameter "'+a[n].name+'" value "'+o+'" does not match pattern!');for(l=0,u=(i=a[n].tpl).length;l<u;++l)f+=!0===i[l]?o:i[l]}else if(!a[n].optional)throw new ReferenceError('Dromeo: Route "'+s.name+'" (Pattern: "'+s.route+'") missing parameter "'+a[n].name+'"!');return f},sub:function(e,t,n,r,l){var u,o,i,a,s,f,c,p,h,d=this,g={};if(!d.isParsed||d.literal)return d;for(u in s=e[0],f=R(r)&&r!==s,i=0,d.captures)E.call(d.captures,u)&&(c=(o=d.captures[u])[0],a=o[1],i+=o[2],e[c]?(c=e[c],f?(i=e.input.indexOf(c,i),p=r.slice(i,i+c.length),i+=c.length):p=c,n&&E.call(n,u)&&n[u]?(R(h=n[u])&&E.call(w.TYPES,h)&&(h=w.TYPES[h]),t[u]=m(h)?h(c):c,g[u]=m(h)?h(p):p):a?(h=a,t[u]=m(h)?h(c):c,g[u]=m(h)?h(p):p):(t[u]=c,g[u]=p)):E.call(t,u)||(t[u]=null,g[u]=null));return l&&(t[String(l)]=g),d}},w.VERSION="1.1.2",w.HTTP_STATUS={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},w.Route=C,w.to_method=x,(w.TYPES={INTEGER:function(e){return parseInt(e,10)||0},STRING:function(e){return R(e)?e:""+String(e)},URLDECODE:function(e){return j(String(e).split("+").join("%20"))},ARRAY:function(e){return y(e)?e:[e]},PARAMS:function(e){return R(e)?w.unglue_params(e):e}}).INT=w.TYPES.INTEGER,w.TYPES.STR=w.TYPES.STRING,w.TYPES.VAR=w.TYPES.URLDECODE,w.TYPES.URLENCODED=w.TYPES.PARAMS,w.glue_params=function(e){var t="";return e&&(t+=p(e,"&",!0)),t},w.unglue_params=function(e){return e?u(e):{}},w.parse_components=function(e,t,n){var r={};return e&&((arguments.length<3||null==n)&&(n="fragment_params"),(arguments.length<2||null==t)&&(t="query_params"),r=function(e,t,n){for(var r=i[n||"php"].exec(e),l={},u=14;u--;)r[u]&&(l[a[u]]=r[u]);return E.call(l,"port")&&(l.port=parseInt(l.port,10)),t?l[t.replace("PHP_URL_","").toLowerCase()]||null:(l.source&&delete l.source,l)}(e),t&&(r.query?r[t]=this.unglue_params(r.query):r[t]={}),n&&(r.fragment?r[n]=this.unglue_params(r.fragment):r[n]={})),r},w.build_components=function(e,t,n,r,l){e=""+e;return(arguments.length<5||null==l)&&(l="#"),(arguments.length<4||null==r)&&(r="?"),t&&(e+=r+this.glue_params(t)),n&&(e+=l+this.glue_params(n)),e},w.defType=function(e,t){e&&m(t)&&(w.TYPES[e]=t)},w.TYPE=function(e){return e&&E.call(w.TYPES,e)?w.TYPES[e]:null},w[e]={constructor:w,_delims:null,_patterns:null,_routes:null,_named_routes:null,_fallback:!1,_prefix:"",dispose:function(){var e,t,n=this;if(n._delims=null,n._patterns=null,n._fallback=null,n._prefix=null,n._routes)for(e=0,t=n._routes.length;e<t;++e)n._routes[e].dispose();return n._routes=null,n._named_routes=null,n},reset:function(){return this._routes=[],this._named_routes={},this._fallback=!1,this},defineDelimiters:function(e){var t,n=this._delims;return e&&(0<(t=e.length)&&e[0]&&(n[0]=e[0]),1<t&&e[1]&&(n[1]=e[1]),2<t&&e[2]&&(n[2]=e[2]),3<t&&e[3]&&(n[3]=e[3]),4<t&&e[4]&&(n[4]=e[4])),this},definePattern:function(e,t,n){return n&&R(n)&&n.length&&E.call(w.TYPES,n)&&(n=w.TYPES[n]),n&&m(n)||(n=null),this._patterns[e]=[t,n],this},dropPattern:function(e){var t=this._patterns;return E.call(t,e)&&delete t[e],this},defineType:function(e,t){return w.defType(e,t),this},glue:function(e){return w.glue_params(e)},unglue:function(e){return w.unglue_params(e)},parse:function(e,t,n){return w.parse_components(e,t,n)},build:function(e,t,n,r,l){return w.build_components(e,t,n,r,l)},redirect:function(e,t,n,r){return e&&(l?t&&(arguments.length<3&&(n=302),arguments.length<4&&(r=!0),r?(!0===r&&(r=w.HTTP_STATUS[n]||""),t.writeHead(n,r,{Location:e})):t.writeHead(n,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e=this,t=arguments,n=t.length,t=1===n?y(t[0])?t[0]:[t[0]]:2===n&&R(t[0])&&m(t[1])?[{route:t[0],handler:t[1],method:"*",defaults:{},types:null}]:t;return g(e._routes,e._named_routes,e._delims,e._patterns,e._prefix,t),e},one:function(){var e=this,t=arguments,n=t.length,t=1===n?y(t[0])?t[0]:[t[0]]:2===n&&R(t[0])&&m(t[1])?[{route:t[0],handler:t[1],method:"*",defaults:{},types:null}]:t;return g(e._routes,e._named_routes,e._delims,e._patterns,e._prefix,t,!0),e},off:function(e,t,n){var r,l,u,o,i=this,a=i._routes,s=i._named_routes;i._prefix;if(!e)return i;if(null==n&&(n="*"),P(e)){if(t=e.handler||t,n=e.method||n,!(e=e.route))return i;for(o=_(e=String(e),x(n)),l=null,r=0,u=a.length;r<u;++r)if(o===a[r].key){l=a[r];break}if(!l)return i;if(t&&m(t)){for(r=(u=l.handlers.length)-1;0<=r;--r)t===l.handlers[r][0]&&l.handlers.splice(r,1);l.handlers.length||d(a,s,o)}else d(a,s,o)}else if(R(e)&&e.length){for(o=_(e=String(e),x(n)),l=null,r=0,u=a.length;r<u;++r)if(o===a[r].key){l=a[r];break}if(!l)return i;if(t&&m(t)){for(r=(u=l.handlers.length)-1;0<=r;--r)t===l.handlers[r][0]&&l.handlers.splice(r,1);l.handlers.length||d(a,s,o)}else d(a,s,o)}return i},fallback:function(e){return arguments.length<1&&(e=!1),!1!==e&&null!==e&&!m(e)||(this._fallback=e),this},make:function(e,t,n){var r=this._named_routes;return E.call(r,e)?r[e].make(t,n):null},route:function(e,t,n,r,l){var u,o,i,a,s,f,c,p,h,d,g,m=this._prefix,_=!0,y=!1;if(e=null!=e?String(e):"",m&&m.length&&(_=m===e.slice(0,m.length)),_){for(n=!1!==n,t=null!=t?String(t).toLowerCase():"*",f=(u=this._routes.slice()).length,s=0;s<f;++s)if(null!=(h=(o=u[s]).match(e,t))){for(y=!0,c=(d=o.handlers.slice()).length,p=0;p<c;++p)(g=d[p])[3]&&g[4]||(i=g[1],a=g[2],i={route:e,method:t,pattern:o.route,fallback:!1,data:S({},i,!0)},R(r)&&(i.route_original=r),o.sub(h,i.data,a,r,l),g[4]=1,g[0](i));if(n)return!0}if(y)return!0}return this._fallback&&this._fallback({route:e,method:t,pattern:null,fallback:!0,data:null}),!1}},w});