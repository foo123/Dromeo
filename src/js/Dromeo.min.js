/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node.js / Browser / XPCOM Javascript
*   @version: 1.1.0
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,n,t){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=r=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}("undefined"!=typeof self?self:this,"Dromeo",function(e){"use strict";function n(e,n,t,r,l,o){var u=this;u.__args__=[e,n],u.isParsed=!1,u.handlers=[],u.route=String(t),u.prefix=String(o),u.method=r,u.pattern=null,u.captures=null,u.literal=!1,u.namespace=null,u.tpl=null,u.name=l||null}function t(e){var n=this;if(!(n instanceof t))return new t(e);n._delims=["{","}","%","%",":"],n._patterns={},n.definePattern("ALPHA","[a-zA-Z\\-_]+"),n.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),n.definePattern("NUMBR","[0-9]+"),n.definePattern("INT","[0-9]+","INT"),n.definePattern("PART","[^\\/?#]+"),n.definePattern("VAR","[^=?&#\\/]+","VAR"),n.definePattern("QUERY","\\?[^?#]+"),n.definePattern("FRAGMENT","#[^?#]+"),n.definePattern("URLENCODED","[^\\/?#]+","URLENCODED"),n.definePattern("ALL",".+"),n._routes=[],n._named_routes={},n._fallback=!1,n._prefix=null!=e?String(e):""}var r={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},l=/^([^|]+\|.+)$/,o=/\((\d+)\)$/,u=/^\s+|\s+$/g,i=/([*+\[\]\(\)?^$\/\\:.])/g,a="prototype",s=Object[a],f=(Array[a],Function[a],s.toString),c=s.hasOwnProperty,p="undefined"!=typeof global&&"[object global]"==f.call(global),d=function(e){return e instanceof Array||"[object Array]"===f.call(e)},h=function(e){return"[object Object]"===f.call(e)},m=function(e){return e instanceof String||"[object String]"===f.call(e)},g=function(e){return e instanceof Number||"[object Number]"===f.call(e)},_=function(e){return"function"==typeof e},P=String[a].trim?function(e){return e.trim()}:function(e){return e.replace(u,"")},y=function(e){return e.length>0},R=function(e){return e.replace(i,"\\$1")},T=function(e,n,t){var r,l;if(t=!0===t,n)for(r in n)c.call(n,r)&&(l=n[r],g(l)?e[r]=0+l:m(l)?e[r]=l.slice():d(l)?e[r]=t?T(new Array(l.length),l,t):l:h(l)?e[r]=t?T({},l,t):l:e[r]=l);return e},b={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},S=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],v=function(e,n,t){for(var r=b[t||"php"].exec(e),l={},o=14;o--;)r[o]&&(l[S[o]]=r[o]);return c.call(l,"port")&&(l.port=parseInt(l.port,10)),n?l[n.replace("PHP_URL_","").toLowerCase()]||null:(l.source&&delete l.source,l)},E=function(e){return decodeURIComponent(""+e)},A=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},N=function(e){return E((""+e).split("+").join("%20"))},j=function(e){return A(e).split("%20").join("+")},k=function(e){var n,t,r,l,o,u,i,a,s,f,p,d,h,m,g=e.replace(/^&+|&+$/g,"").split("&"),_=g.length,y={},R=[];for(n=0;n<_;n++)if(u=g[n].split("="),i=E(P(u[0])),a=u.length<2?"":E(P(u[1])),(t=i.indexOf("\0"))>-1&&(i=i.slice(0,t)),i&&"["!==i.charAt(0)){for(f=[],s=0,t=0;t<i.length;t++)if("["!==i.charAt(t)||s){if("]"===i.charAt(t)&&s&&(f.length||f.push(i.slice(0,s-1)),f.push(i.substr(s,t-s)),s=0,"["!==i.charAt(t+1)))break}else s=t+1;for(f.length||(f=[i]),t=0;t<f[0].length&&(" "!==(o=f[0].charAt(t))&&"."!==o&&"["!==o||(f[0]=f[0].substr(0,t)+"_"+f[0].substr(t+1)),"["!==o);t++);for(i=null,r=l=y,d=f.length?P(f[f.length-1].replace(/^['"]|['"]$/g,"")):null,t=0,p=f.length;t<p;t++)h=i,i=f[t].replace(/^['"]|['"]$/g,""),m=r,r=l,""!==P(i)||0===t?(c.call(l,i)||(l[i]=t+1===p-1&&""===d?[]:{}),l=l[i]):i=!0;!0===i?r.push(a):(i==+i&&R.push({key:h,obj:m}),r[i]=a)}for(n=R.length-1;n>=0;n--)l=R[n].key?R[n].obj[R[n].key]:R[n].obj,x(l)&&(l=w(l),R[n].key?R[n].obj[R[n].key]=l:y=l);return y},C=function(e){if("function"==typeof Object.keys)return Object.keys(e);var n,t,r;if(d(e))for(n=new Array(r=e.length),t=0;t<r;t++)n[t]=String(t);else{n=[];for(t in e)c.call(e,t)&&n.push(t)}return n},w=function(e){if(d(e))return e;if("function"==typeof Object.values)return Object.values(e);var n,t=[];for(n in e)c.call(e,n)&&t.push(e[n]);return t},x=function(e){if(d(e))return!0;if(h(e)){var n,t=C(e),r=t.length;for(n=0;n<r;n++)if(n!==+t[n])return!1;return!0}return!1},L=function(e,n,t){var r,l=n.length;if(!0===t)return 0<l&&-1!==n.indexOf(e);for(r=0;r<l;r++)if(e==n[r])return!0;return!1},q=function(e,n,t,r){var l,o,u=r?A:j;if(!0===n?n="1":!1===n&&(n="0"),null!=n){if("object"==typeof n){o=[];for(l in n)c.call(n,l)&&null!=n[l]&&o.push(q(e+"["+l+"]",n[l],t,r));return o.join(t)}return u(e)+"="+u(n)}return""},I=function(e,n,t){var r,l,o,u=[];arguments.length<2&&(n="&"),arguments.length<3&&(t=!1);for(l in e)c.call(e,l)&&(r=e[l],""!=(o=q(l,r,n,t))&&u.push(o));return u.join(n)},U=function(e,n,t){if(n!==t&&t){var r,l,o=[];for(e=e.split(n),l=0;l<e.length;l++)r=(r=e[l]).split(t),o.push(r[0]),r.length>1&&o.push(r[1]);return o}return e.split(n)},O=function(e,n,t){var r,o,u,i,a,s,f,p,d=0,h={};for(i=[],s=[],f=null,o=(t=U(t,e[2],e[3])).length,u=!1,r=0;r<o;r++)u?(t[r].length&&(c.call(n,t[r])?(i.push("("+n[t[r]][0]+")"),d++,n[t[r]][1]&&(h[d]=n[t[r]][1]),null===f&&(f=i[i.length-1])):(a=t[r].match(l))?(i.push("("+a[1].split("|").filter(y).map(R).join("|")+")"),d++,null===f&&(f=i[i.length-1])):t[r].length&&(i.push("("+R(t[r])+")"),d++,null===f&&(f=i[i.length-1]))),s.push(!0),u=!1):(t[r].length&&(i.push(R(t[r])),s.push(t[r])),u=!0);return 1===i.length&&1===d?(h[0]=h[1]?h[1]:null,p=i.join(""),[p,d,h,s,f||p]):(h[0]=null,p="("+i.join("")+")",[p,d+1,h,s,f||p])},Y=function(e,n,t,r,l){var u,i,a,s,f,p,d,h,m,g,_,y,T,b,S,v,E;if(0>t.indexOf(e[0]))return[t,l&&l.length?l+t:t,{},r,!0,[t]];for(s=(u=U(t,e[0],e[1])).length,d=!1,h="",_=0,T={},E=[],l&&l.length&&(h+=R(l)),a=0;a<s;a++)i=u[a],d?(f=!1,p=!1,y=null,(m=i.split(e[4]))[0].length||(m[0]=e[2]+"PART"+e[3]),S=O(e,n,m[0]),m.length>1&&((f=(b=P(m[1])).length&&"?"===b.charAt(0))&&(b=b.slice(1)),(g=b.match(o))?(b=b.slice(0,-g[0].length),v=parseInt(g[1],10),y=c.call(S[2],v)?S[2][v]:null,v>=0&&v<S[1]?v+=_+1:v=_+1):(y=S[2][0]?S[2][0]:null,v=_+1),p=b.length>0),h+=S[0],_+=S[1],f&&(h+="?"),p&&(T[b]=[v,y]),p&&E.push({name:b,optional:f,re:new RegExp("^"+S[4]+"$"),tpl:S[3]}),d=!1):(h+=R(i),E.push(i),d=!0);return[t,new RegExp("^"+h+"$"),T,r,!1,E]},D=function(e,n,t){var r;for(r=e.length-1;r>=0;r--)t===e[r].route&&(t.name&&c.call(n,t.name)&&delete n[t.name],e[r].dispose(),e.splice(r,1))},M=function(e,t,r,l,o,u,i){if(u&&m(u.route)&&u.route.length&&u.handler&&_(u.handler)){i=!0===i;var a,s,f,c=u.handler,p=u.defaults||{},d=u.types||null,h=u.name||null,g=u.method?u.method.map?u.method.map(function(e){return e.toLowerCase()}):[u.method.toLowerCase()]:["*"];for(u=u.route,L("*",g)&&(g=["*"]),a=null,s=0,f=e.length;s<f;s++)if(u===e[s].route){a=e[s];break}a||(a=new n(r,l,u,g,h,o),e.push(a),a.name&&a.name.length&&(t[a.name]=a)),a.handlers.push([c,p,d,i,0])}},H=function(e,n,t,r,l,o,u){var i,a;for(u=!!u,a=0;a<o.length;a++)i=o[a],M(e,n,t,r,l,i,u)};return n[a]={constructor:n,__args__:null,isParsed:!1,handlers:null,route:null,prefix:null,pattern:null,captures:null,tpl:null,method:null,literal:null,namespace:null,name:null,dispose:function(){var e=this;return e.__args__=null,e.isParsed=null,e.handlers=null,e.route=null,e.prefix=null,e.pattern=null,e.captures=null,e.tpl=null,e.method=null,e.literal=null,e.namespace=null,e.name=null,e},parse:function(){var e=this;if(e.isParsed)return e;var n=Y(e.__args__[0],e.__args__[1],e.route,e.method,e.prefix);return e.pattern=n[1],e.captures=n[2],e.tpl=n[5],e.literal=!0===n[4],e.__args__=null,e.isParsed=!0,e},match:function(e,n){var t=this;return n=n||"*",L(n,t.method)||"*"===t.method[0]?(t.isParsed||t.parse(),e=String(e),t.literal?e===t.pattern?[]:null:e.match(t.pattern)):null},make:function(e,n){var t,r,l,o,u,i,a,s=this,f="";for(e=e||{},n=!0===n,s.isParsed||s.parse(),t=0,r=(a=s.tpl).length;t<r;t++)if(m(a[t]))f+=a[t];else{if(!c.call(e,a[t].name)||null==e[a[t].name]){if(a[t].optional)continue;throw new ReferenceError('Dromeo: Route "'+s.name+'" (Pattern: "'+s.route+'") missing parameter "'+a[t].name+'"!')}if(u=String(e[a[t].name]),n&&!a[t].re.test(u))throw new ReferenceError('Dromeo: Route "'+s.name+'" (Pattern: "'+s.route+'") parameter "'+a[t].name+'" value "'+u+'" does not match pattern!');for(l=0,o=(i=a[t].tpl).length;l<o;l++)f+=!0===i[l]?u:i[l]}return f},sub:function(e,n,r){var l,o,u,i,a,s=this;if(!s.isParsed||s.literal)return s;for(l in s.captures)c.call(s.captures,l)&&(u=(o=s.captures[l])[0],i=o[1],e[u]?r&&c.call(r,l)&&r[l]?(a=r[l],m(a)&&c.call(t.TYPES,a)&&(a=t.TYPES[a]),n[l]=_(a)?a(e[u]):e[u]):i?(a=i,n[l]=_(a)?a(e[u]):e[u]):n[l]=e[u]:c.call(n,l)||(n[l]=null));return s}},t.VERSION="1.1.0",t.HTTP_STATUS=r,t.Route=n,t.TYPES={INTEGER:function(e){return parseInt(e,10)||0},STRING:function(e){return m(e)?e:""+String(e)},URLDECODE:function(e){return N(e)},ARRAY:function(e){return d(e)?e:[e]},PARAMS:function(e){return m(e)?t.unglue_params(e):e}},t.TYPES.INT=t.TYPES.INTEGER,t.TYPES.STR=t.TYPES.STRING,t.TYPES.VAR=t.TYPES.URLDECODE,t.TYPES.URLENCODED=t.TYPES.PARAMS,t.glue_params=function(e){var n="";return e&&(n+=I(e,"&",!0)),n},t.unglue_params=function(e){return e?k(e):{}},t.parse_components=function(e,n,t){var r=this,l={};return e&&((arguments.length<3||null==t)&&(t="fragment_params"),(arguments.length<2||null==n)&&(n="query_params"),l=v(e),n&&(l.query?l[n]=r.unglue_params(l.query):l[n]={}),t&&(l.fragment?l[t]=r.unglue_params(l.fragment):l[t]={})),l},t.build_components=function(e,n,t,r,l){var o=this,u=""+e;return(arguments.length<5||null==l)&&(l="#"),(arguments.length<4||null==r)&&(r="?"),n&&(u+=r+o.glue_params(n)),t&&(u+=l+o.glue_params(t)),u},t.defType=function(e,n){e&&_(n)&&(t.TYPES[e]=n)},t.TYPE=function(e){return e&&c.call(t.TYPES,e)?t.TYPES[e]:null},t[a]={constructor:t,_delims:null,_patterns:null,_routes:null,_named_routes:null,_fallback:!1,_prefix:"",dispose:function(){var e,n,t=this;if(t._delims=null,t._patterns=null,t._fallback=null,t._prefix=null,t._routes)for(e=0,n=t._routes.length;e<n;e++)t._routes[e].dispose();return t._routes=null,t._named_routes=null,t},reset:function(){var e=this;return e._routes=[],e._named_routes={},e._fallback=!1,e},defineDelimiters:function(e){var n,t=this,r=t._delims;return e&&((n=e.length)>0&&e[0]&&(r[0]=e[0]),n>1&&e[1]&&(r[1]=e[1]),n>2&&e[2]&&(r[2]=e[2]),n>3&&e[3]&&(r[3]=e[3]),n>4&&e[4]&&(r[4]=e[4])),t},definePattern:function(e,n,r){var l=this;return r&&m(r)&&r.length&&c.call(t.TYPES,r)&&(r=t.TYPES[r]),r&&_(r)||(r=null),l._patterns[e]=[n,r],l},dropPattern:function(e){var n=this,t=n._patterns;return c.call(t,e)&&delete t[e],n},defineType:function(e,n){return t.defType(e,n),this},glue:function(e){return t.glue_params(e)},unglue:function(e){return t.unglue_params(e)},parse:function(e,n,r){return t.parse_components(e,n,r)},build:function(e,n,r,l,o){return t.build_components(e,n,r,l,o)},redirect:function(e,n,r,l){return e&&(p?n&&(arguments.length<3&&(r=302),arguments.length<4&&(l=!0),l?(!0===l&&(l=t.HTTP_STATUS[r]||""),n.writeHead(r,l,{Location:e})):n.writeHead(r,{Location:e}),n.end()):document.location.href=e),this},on:function(){var e,n=this,t=arguments,r=t.length;return e=1===r?d(t[0])?t[0]:[t[0]]:2===r&&m(t[0])&&_(t[1])?[{route:t[0],handler:t[1],method:"*",defaults:{},types:null}]:t,H(n._routes,n._named_routes,n._delims,n._patterns,n._prefix,e),n},one:function(){var e,n=this,t=arguments,r=t.length;return e=1===r?d(t[0])?t[0]:[t[0]]:2===r&&m(t[0])&&_(t[1])?[{route:t[0],handler:t[1],method:"*",defaults:{},types:null}]:t,H(n._routes,n._named_routes,n._delims,n._patterns,n._prefix,e,!0),n},off:function(e,n){var t,r,l,o=this,u=o._routes,i=o._named_routes;o._prefix;if(!e)return o;if(h(e)){if(n=e.handler||n,!(e=e.route))return o;for(e=String(e),r=null,t=0,l=u.length;t<l;t++)if(e===u[t].route){r=u[t];break}if(!r)return o;if(n&&_(n)){for(t=(l=r.handlers.length)-1;t>=0;t--)n===r.handlers[t][0]&&r.handlers.splice(t,1);r.handlers.length||D(u,i,e)}else D(u,i,e)}else if(m(e)&&e.length){for(e=String(e),r=null,t=0,l=u.length;t<l;t++)if(e===u[t].route){r=u[t];break}if(!r)return o;if(n&&_(n)){for(t=(l=r.handlers.length)-1;t>=0;t--)n===r.handlers[t][0]&&r.handlers.splice(t,1);r.handlers.length||D(u,i,e)}else D(u,i,e)}return o},fallback:function(e){var n=this;return 1>arguments.length&&(e=!1),(!1===e||null===e||_(e))&&(n._fallback=e),n},make:function(e,n,t){var r=this._named_routes;return c.call(r,e)?r[e].make(n,t):null},route:function(e,n,t){var r,l,o,u,i,a,s,f,c,p,d,h,m,g=this;if(n=n?String(n).toLowerCase():"*",e){for(t=!1!==t,m=!1,s=(r=g._routes.slice()).length,a=0;a<s;a++)if(l=r[a],null!=(p=l.match(e,n))){for(m=!0,f=(d=l.handlers.slice(0)).length,c=0;c<f;c++)(h=d[c])[3]&&h[4]||(u=h[1],i=h[2],o={route:e,method:n,pattern:l.route,fallback:!1,data:T({},u,!0)},l.sub(p,o.data,i),h[4]=1,h[0](o));if(t)return!0}if(m)return!0}return!!g._fallback&&(g._fallback({route:e,method:n,pattern:null,fallback:!0,data:null}),!1)}},t});