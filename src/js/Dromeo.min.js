/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node/JS
*   @version: 0.6
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r,o="object"==typeof module&&module.exports,i="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:i&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,o){return n.call(e,{AMD:o})}):t in e||(e[t]=r=n.call(e,{})||1)&&i&&define(t,[],function(){return r})}(this,"Dromeo",function(e,t){"use strict";function n(e,t,n,r,o){var i=this;i.handlers=[],i.route=e,i.pattern=t,i.captures=n,i.method=r?r.toLowerCase():"*",i.namespace=o||null,i.dispose=function(){return i.handlers=null,i.route=null,i.pattern=null,i.captures=null,i.method=null,i.namespace=null,i}}var r="0.6",o={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},i=/^([a-zA-Z0-9-_]+\|[a-zA-Z0-9-_|]+)$/,l=/\((\d+)\)$/,a="prototype",u=Object[a],s=(Array[a],Function[a],u.toString),c="hasOwnProperty",d="undefined"!=typeof global&&"[object global]"==s.call(global),f=function(e){return"[object Array]"===s.call(e)||e instanceof Array},h=function(e){return"[object Object]"===s.call(e)||e instanceof Object},p=function(e){return"[object String]"===s.call(e)||e instanceof String},g=function(e){return"number"==typeof e||e instanceof Number},m=function(e){return"[object Function]"===s.call(e)||e instanceof Function},_=String[a].trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},b=function(e){return e.length>0},v=function(e){return e.replace(/([*+\[\]\(\)?^$\/\\:])/g,"\\$1")},y=function(e,t,n){var r,o;if(n=!0===n,t)for(r in t)t[c](r)&&(o=t[r],e[r]=g(o)?0+o:p(o)?o.slice():f(o)?n?y([],o,n):o:h(o)&&n?y({},o,n):o);return e},R={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},A=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],P=function(e,t,n){for(var r=R[n||"php"].exec(e),o={},i=14;i--;)r[i]&&(o[A[i]]=r[i]);return o[c]("port")&&(o.port=parseInt(o.port,10)),t?o[t.replace("PHP_URL_","").toLowerCase()]||null:(o.source&&delete o.source,o)},q=function(e){return decodeURIComponent(""+e)},L=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},j=function(e){return L(e).split("%20").join("+")},w=function(e){var n,r,o,i,l,a,u,s,d,f,h,p,g,m=e.replace(/^&/,"").replace(/&$/,"").split("&"),b=m.length,v={};for(n=0;b>n;n++)if(s=m[n].split("="),d=q(_(s[0])),f=s.length<2?"":q(_(s[1])),r=d.indexOf("\x00"),r>-1&&(d=d.slice(0,r)),d&&"["!==d.charAt(0)){for(p=[],h=0,r=0;r<d.length;r++)if("["!==d.charAt(r)||h){if("]"===d.charAt(r)&&h&&(p.length||p.push(d.slice(0,h-1)),p.push(d.substr(h,r-h)),h=0,"["!==d.charAt(r+1)))break}else h=r+1;for(p.length||(p=[d]),r=0;r<p[0].length&&(u=p[0].charAt(r),(" "===u||"."===u||"["===u)&&(p[0]=p[0].substr(0,r)+"_"+p[0].substr(r+1)),"["!==u);r++);for(a=v,r=0,g=p.length;g>r;r++)if(d=p[r].replace(/^['"]/,"").replace(/['"]$/,""),l=a,""!==d&&" "!==d||0===r)t===a[d]&&(a[d]={}),a=a[d];else{o=-1;for(i in a)a[c](i)&&+i>o&&i.match(/^\d+$/g)&&(o=+i);d=o+1}l[d]=f}return v},N=function(e,t,n,r){var o,i,l=r?L:j;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){i=[];for(o in t)t[c](o)&&null!=t[o]&&i.push(N(e+"["+o+"]",t[o],n,r));return i.join(n)}return l(e)+"="+l(t)}return""},C=function(e,t,n){var r,o,i,l=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(o in e)e[c](o)&&(r=e[o],i=N(o,r,t,n),""!=i&&l.push(i));return l.join(t)},T=function(e,t,n){if(n){var r,o,i=[];for(e=e.split(t),o=0;o<e.length;o++)r=e[o],r=r.split(n),i.push(r[0]),r.length>1&&i.push(r[1]);return i}return e.split(t)},k=function(e,t,n){var r,o,l,a,u,s=0;for(n=T(n,e[3]),a=[],o=n.length,l=!1,r=0;o>r;r++)l?(n[r].length&&(t[n[r]]?(a.push("("+t[n[r]]+")"),s++):(u=n[r].match(i))?(a.push("("+u[1].split("|").filter(b).map(v).join("|")+")"),s++):a.push(v(n[r]))),l=!1):(n[r].length&&a.push(v(n[r])),l=!0);return 1===a.length&&1===s?[a.join(""),s]:["("+a.join("")+")",s+1]},x=function(e,t,r,o){var i,a,u,s,c,d,f,h,p,g,m,b,y,R,A;for(i=T(r,e[0],e[1]),s=i.length,f=!1,h="",m=0,b={},u=0;s>u;u++)a=i[u],f?(c=!1,d=!1,p=a.split(e[2]),R=k(e,t,p[0]),p.length>1&&(y=_(p[1]),c=y.length&&"?"===y.charAt(0),c&&(y=y.slice(1)),(g=y.match(l))?(y=y.slice(0,-g[0].length),A=parseInt(g[1],10),A>=0&&A<R[1]?A+=m+1:A=m+1):A=m+1,d=y.length>0),h+=R[0],m+=R[1],c&&(h+="?"),d&&(b[y]=A),f=!1):(h+=v(a),f=!0);return new n(r,new RegExp("^"+h+"$"),b,o)},S=function(e,t,n,r){var o,i=t.length;for(o=i-1;o>=0;o--)n===t[o].route&&r===t[o].method&&t.splice(o,1);e[n].dispose(),delete e[n]},U=function(e,t,n,r,o,i){if(o&&p(o.route)&&o.route.length&&o.handler&&m(o.handler)){i=!0===i;var l,a=o.handler,u=o.defaults||{},s=o.method?o.method.toLowerCase():"*";o=o.route,e[c](s)||(e[s]={}),l=e[s],l[c](o)?l[o].handlers.push([a,u,i,0]):(l[o]=x(n,r,o,s),l[o].handlers.push([a,u,i,0]),t.push(l[o]))}},I=function(e,t,n,r,o,i){var l,a;for(i=!!i,a=0;a<o.length;a++)l=o[a],U(e,t,n,r,l,i)},$=function(){var e=this;e._delims=["{","}",":","%"],e._patterns={},e.definePattern("ALPHA","[a-zA-Z\\-_]+"),e.definePattern("NUMBR","[0-9]+"),e.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),e.definePattern("QUERY","\\?[^?#]+"),e.definePattern("FRAGM","#[^?#]+"),e.definePattern("ALL",".+"),e._handlers={"*":{}},e._routes=[],e._fallback=!1};return $.VERSION=r,$.Route=n,$[a]={constructor:$,_delims:null,_patterns:null,_handlers:null,_routes:null,_fallback:!1,dispose:function(){var e,t,n,r=this;r._delims=null,r._patterns=null,r._routes=null,r._fallback=null;for(t in r._handlers)if(r._handlers[c](t)){n=r._handlers[t];for(e in n)n[c](e)&&(n[e].dispose(),n[e]=null)}return r._handlers=null,r},reset:function(){var e=this;return e._handlers={"*":{}},e._routes=[],e._fallback=!1,e},defineDelimiters:function(e){var t,n=this,r=n._delims;return e&&(t=e.length,t>0&&e[0]&&(r[0]=e[0]),t>1&&e[1]&&(r[1]=e[1]),t>2&&e[2]&&(r[2]=e[2]),t>3&&e[3]&&(r[3]=e[3])),n},definePattern:function(e,t){var n=this;return n._patterns[e]=t,n},dropPattern:function(e){var t=this,n=t._patterns;return n[c](e)&&delete n[e],t},glue:function(e){var t="";return e&&(t+=C(e,"&",!0)),t},unglue:function(e){var t=e?w(e):{};return t},parse:function(e,t,n){var r=this,o={};return e&&(arguments.length<3&&(n="fragment_params"),arguments.length<2&&(t="query_params"),o=P(e),t&&(o[t]=o.query?r.unglue(o.query):{}),n&&(o[n]=o.fragment?r.unglue(o.fragment):{})),o},build:function(e,t,n,r,o){var i=this,l=""+e;return arguments.length<5&&(o="#"),arguments.length<4&&(r="?"),t&&(l+=r+i.glue(t)),n&&(l+=o+i.glue(n)),l},redirect:function(e,t,n,r){return e&&(d?t&&(arguments.length<3&&(n=302),arguments.length<4&&(r=!0),r?(!0===r&&(r=o[n]||""),t.writeHead(n,r,{Location:e})):t.writeHead(n,{Location:e}),t.end()):(document.location.href=e,document.location.reload(!0))),this},on:function(){var e=this,t=arguments,n=t.length;return 1===n?f(t[0])?I(e._handlers,e._routes,e._delims,e._patterns,t[0]):I(e._handlers,e._routes,e._delims,e._patterns,[t[0]]):I(e._handlers,e._routes,e._delims,e._patterns,t),e},one:function(){var e=this,t=arguments,n=t.length;return 1===n?f(t[0])?I(e._handlers,e._routes,e._delims,e._patterns,t[0],!0):I(e._handlers,e._routes,e._delims,e._patterns,[t[0]],!0):I(e._handlers,e._routes,e._delims,e._patterns,t,!0),e},off:function(e,t){var n,r,o,i,l,a=this,u=a._routes,s=a._handlers;if(e)if(h(e)){if(o=e.method?e.method.toLowerCase():"*",t=e.handler||t,e=e.route,e&&s[c](o)&&(i=s[o],i[c](e)))if(t&&m(t)){for(r=i[e],l=r.handlers.length,n=l-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||S(i,u,e,o)}else S(i,u,e,o)}else if(p(e)&&e.length)for(o in s)if(s[c](o)&&(i=s[o],i[c](e)))if(t&&m(t)){for(r=i[e],l=r.handlers.length,n=l-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||S(i,u,e,o)}else S(i,u,e,o);return a},fallback:function(e){var t=this;return 1>arguments.length&&(e=!1),(!1===e||null===e||m(e))&&(t._fallback=e),t},route:function(e,t){var n,r,o,i,l,a,u,s,d,f,h,p,g=this,m=g._routes;if(e)for(t=t?t.toLowerCase():"*",l=m.length,i=0;l>i;i++)if(n=m[i],(t===n.method||"*"===n.method)&&(s=e.match(n.pattern))){for(h=n.handlers.slice(0),a=h.length,u=0;a>u;u++)if(p=h[u],!p[2]||!p[3]){o=p[1],r={route:e,fallback:!1,data:y({},o,!0)};for(d in n.captures)n.captures[c](d)&&(f=n.captures[d],s[f]?r.data[d]=s[f]:r.data[c](d)||(r.data[d]=null));p[3]=1,p[0](r)}for(u=n.handlers.length-1;u>=0;u--)p=n.handlers[u],p[2]&&p[3]&&n.handlers.splice(u,1);return!0}return g._fallback?(g._fallback({route:e,fallback:!0,data:null}),!1):!1}},$});