/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node/XPCOM/JS
*   @version: 0.6.9
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}(this,"Dromeo",function(e){"use strict";function t(e,t,n,r){var o=this;o.__args__=[e,t],o.isParsed=!1,o.handlers=[],o.route=n,o.method=r?r.toLowerCase():"*",o.pattern=null,o.captures=null,o.literal=!1,o.namespace=null,o.parse=function(){if(o.isParsed)return o;var e=O(o.__args__[0],o.__args__[1],o.route,o.method);return o.pattern=e[1],o.captures=e[2],o.literal=!0===e[4],o.__args__=null,o.isParsed=!0,o},o.dispose=function(){return o.__args__=null,o.isParsed=null,o.handlers=null,o.route=null,o.pattern=null,o.captures=null,o.method=null,o.literal=null,o.namespace=null,o}}function n(e){return parseInt(e,10)||0}function r(e){return T(e)?e:""+String(e)}function o(e){return w(e)}function l(e){return P(e)?e:[e]}function i(e){return T(e)?H.unglue_params(e):e}var u="0.6.9",a={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},s=/^([^|]+\|.+)$/,c=/\((\d+)\)$/,f=/^\s+|\s+$/g,d=/([*+\[\]\(\)?^$\/\\:])/g,p="prototype",h=Object[p],g=(Array[p],Function[p],h.toString),_="hasOwnProperty",m="undefined"!=typeof global&&"[object global]"==g.call(global),P=function(e){return e instanceof Array||"[object Array]"===g.call(e)},R=function(e){return e instanceof Object||"[object Object]"===g.call(e)},T=function(e){return e instanceof String||"[object String]"===g.call(e)},y=function(e){return e instanceof Number||"[object Number]"===g.call(e)},E=function(e){return"function"==typeof e},b=String[p].trim?function(e){return e.trim()}:function(e){return e.replace(f,"")},v=function(e){return e.length>0},S=function(e){return e.replace(d,"\\$1")},A=function(e,t,n){var r,o;if(n=!0===n,t)for(r in t)t[_](r)&&(o=t[r],y(o)?e[r]=0+o:T(o)?e[r]=o.slice():P(o)?e[r]=n?A(new Array(o.length),o,n):o:R(o)?e[r]=n?A({},o,n):o:e[r]=o);return e},N={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},C=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],L=function(e,t,n){for(var r=N[n||"php"].exec(e),o={},l=14;l--;)r[l]&&(o[C[l]]=r[l]);return o[_]("port")&&(o.port=parseInt(o.port,10)),t?o[t.replace("PHP_URL_","").toLowerCase()]||null:(o.source&&delete o.source,o)},j=function(e){return decodeURIComponent(""+e)},q=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},w=function(e){return j((""+e).split("+").join("%20"))},x=function(e){return q(e).split("%20").join("+")},I=function(t){var n,r,o,l,i,u,a,s,c,f,d,p,h,g=t.replace(/^&/,"").replace(/&$/,"").split("&"),m=g.length,P={};for(n=0;m>n;n++)if(s=g[n].split("="),c=j(b(s[0])),f=s.length<2?"":j(b(s[1])),r=c.indexOf("\x00"),r>-1&&(c=c.slice(0,r)),c&&"["!==c.charAt(0)){for(p=[],d=0,r=0;r<c.length;r++)if("["!==c.charAt(r)||d){if("]"===c.charAt(r)&&d&&(p.length||p.push(c.slice(0,d-1)),p.push(c.substr(d,r-d)),d=0,"["!==c.charAt(r+1)))break}else d=r+1;for(p.length||(p=[c]),r=0;r<p[0].length&&(a=p[0].charAt(r)," "!==a&&"."!==a&&"["!==a||(p[0]=p[0].substr(0,r)+"_"+p[0].substr(r+1)),"["!==a);r++);for(u=P,r=0,h=p.length;h>r;r++)if(c=p[r].replace(/^['"]|['"]$/g,""),i=u,""!==c&&" "!==c||0===r)e===u[c]&&(u[c]={}),u=u[c];else{o=-1;for(l in u)u[_](l)&&+l>o&&l.match(/^\d+$/g)&&(o=+l);c=o+1}i[c]=f}return P},U=function(e,t,n,r){var o,l,i=r?q:x;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){l=[];for(o in t)t[_](o)&&null!=t[o]&&l.push(U(e+"["+o+"]",t[o],n,r));return l.join(n)}return i(e)+"="+i(t)}return""},Y=function(e,t,n){var r,o,l,i=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(o in e)e[_](o)&&(r=e[o],l=U(o,r,t,n),""!=l&&i.push(l));return i.join(t)},k=function(e,t,n){if(n){var r,o,l=[];for(e=e.split(t),o=0;o<e.length;o++)r=e[o],r=r.split(n),l.push(r[0]),r.length>1&&l.push(r[1]);return l}return e.split(t)},D=function(e,t,n){var r,o,l,i,u,a=0,c={};for(n=k(n,e[2],e[3]),i=[],o=n.length,l=!1,r=0;o>r;r++)l?(n[r].length&&(t[_](n[r])?(i.push("("+t[n[r]][0]+")"),a++,t[n[r]][1]&&(c[a]=t[n[r]][1])):(u=n[r].match(s))?(i.push("("+u[1].split("|").filter(v).map(S).join("|")+")"),a++):n[r].length&&(i.push("("+S(n[r])+")"),a++)),l=!1):(n[r].length&&i.push(S(n[r])),l=!0);return 1===i.length&&1===a?(c[0]=c[1]?c[1]:null,[i.join(""),a,c]):(c[0]=null,["("+i.join("")+")",a+1,c])},O=function(e,t,n,r){var o,l,i,u,a,s,f,d,p,h,g,m,P,R,T,y;if(0>n.indexOf(e[0]))return[n,n,{},r,!0];for(o=k(n,e[0],e[1]),u=o.length,f=!1,d="",g=0,P={},i=0;u>i;i++)l=o[i],f?(a=!1,s=!1,m=null,p=l.split(e[4]),T=D(e,t,p[0]),p.length>1&&(R=b(p[1]),a=R.length&&"?"===R.charAt(0),a&&(R=R.slice(1)),(h=R.match(c))?(R=R.slice(0,-h[0].length),y=parseInt(h[1],10),m=T[2][_](y)?T[2][y]:null,y>=0&&y<T[1]?y+=g+1:y=g+1):(m=T[2][0]?T[2][0]:null,y=g+1),s=R.length>0),d+=T[0],g+=T[1],a&&(d+="?"),s&&(P[R]=[y,m]),f=!1):(d+=S(l),f=!0);return[n,new RegExp("^"+d+"$"),P,r,!1]},M=function(e,t,n,r){var o,l=t.length;for(o=l-1;o>=0;o--)n===t[o].route&&r===t[o].method&&t.splice(o,1);e[n].dispose(),delete e[n]},F=function(e,n,r,o,l,i,u){if(i&&T(i.route)&&i.route.length&&i.handler&&E(i.handler)){u=!0===u;var a,s=i.handler,c=i.defaults||{},f=i.types||null,d=i.method?i.method.toLowerCase():"*";i=l+i.route,e[_](d)||(e[d]={}),a=e[d],a[_](i)?a[i].handlers.push([s,c,f,u,0]):(a[i]=new t(r,o,i,d),a[i].handlers.push([s,c,f,u,0]),n.push(a[i]))}},$=function(e,t,n,r,o,l,i){var u,a;for(i=!!i,a=0;a<l.length;a++)u=l[a],F(e,t,n,r,o,u,i)},H=function G(e){var t=this;return t instanceof G?(t._delims=["{","}","%","%",":"],t._patterns={},t.definePattern("ALPHA","[a-zA-Z\\-_]+"),t.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),t.definePattern("NUMBR","[0-9]+"),t.definePattern("INT","[0-9]+","INT"),t.definePattern("PART","[^\\/?#]+"),t.definePattern("VAR","[^=?&#\\/]+","VAR"),t.definePattern("QUERY","\\?[^?#]+"),t.definePattern("FRAGMENT","#[^?#]+"),t.definePattern("URLENCODED","[^\\/?#]+","URLENCODED"),t.definePattern("ALL",".+"),t._handlers={"*":{}},t._routes=[],t._fallback=!1,void(t._prefix=e?e:"")):new G(e)};return H.VERSION=u,H.Route=t,H.TYPES={INTEGER:n,STRING:r,URLDECODE:o,ARRAY:l,PARAMS:i},H.TYPES.INT=H.TYPES.INTEGER,H.TYPES.STR=H.TYPES.STRING,H.TYPES.VAR=H.TYPES.URLDECODE,H.TYPES.URLENCODED=H.TYPES.PARAMS,H.glue_params=function(e){var t="";return e&&(t+=Y(e,"&",!0)),t},H.unglue_params=function(e){var t=e?I(e):{};return t},H.parse_components=function(e,t,n){var r=this,o={};return e&&(arguments.length<3&&(n="fragment_params"),arguments.length<2&&(t="query_params"),o=L(e),t&&(o.query?o[t]=r.unglue_params(o.query):o[t]={}),n&&(o.fragment?o[n]=r.unglue_params(o.fragment):o[n]={})),o},H.build_components=function(e,t,n,r,o){var l=this,i=""+e;return arguments.length<5&&(o="#"),arguments.length<4&&(r="?"),t&&(i+=r+l.glue_params(t)),n&&(i+=o+l.glue_params(n)),i},H.defType=function(e,t){e&&E(t)&&(H.TYPES[e]=t)},H.TYPE=function(e){return e&&H.TYPES[_](e)?H.TYPES[e]:null},H[p]={constructor:H,_delims:null,_patterns:null,_handlers:null,_routes:null,_fallback:!1,_prefix:"",dispose:function(){var e,t,n,r=this;r._delims=null,r._patterns=null,r._routes=null,r._fallback=null,r._prefix=null;for(t in r._handlers)if(r._handlers[_](t)){n=r._handlers[t];for(e in n)n[_](e)&&(n[e].dispose(),n[e]=null)}return r._handlers=null,r},reset:function(){var e=this;return e._handlers={"*":{}},e._routes=[],e._fallback=!1,e},defineDelimiters:function(e){var t,n=this,r=n._delims;return e&&(t=e.length,t>0&&e[0]&&(r[0]=e[0]),t>1&&e[1]&&(r[1]=e[1]),t>2&&e[2]&&(r[2]=e[2]),t>3&&e[3]&&(r[3]=e[3]),t>4&&e[4]&&(r[4]=e[4])),n},definePattern:function(e,t,n){var r=this;return n&&T(n)&&n.length&&H.TYPES[_](n)&&(n=H.TYPES[n]),n&&E(n)||(n=null),r._patterns[e]=[t,n],r},dropPattern:function(e){var t=this,n=t._patterns;return n[_](e)&&delete n[e],t},defineType:function(e,t){return H.defType(e,t),this},glue:function(e){return H.glue_params(e)},unglue:function(e){return H.unglue_params(e)},parse:function(e,t,n){return H.parse_components(e,t,n)},build:function(e,t,n,r,o){return H.build_components(e,t,n,r,o)},redirect:function(e,t,n,r){return e&&(m?t&&(arguments.length<3&&(n=302),arguments.length<4&&(r=!0),r?(!0===r&&(r=a[n]||""),t.writeHead(n,r,{Location:e})):t.writeHead(n,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?P(n[0])?n[0]:[n[0]]:2===r&&T(n[0])&&E(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,$(t._handlers,t._routes,t._delims,t._patterns,t._prefix,e),t},one:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?P(n[0])?n[0]:[n[0]]:2===r&&T(n[0])&&E(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,$(t._handlers,t._routes,t._delims,t._patterns,t._prefix,e,!0),t},off:function(e,t){var n,r,o,l,i,u=this,a=u._routes,s=u._handlers,c=u._prefix;if(e)if(R(e)){if(o=e.method?e.method.toLowerCase():"*",t=e.handler||t,e=e.route,e&&s[_](o)&&(e=c+e,l=s[o],l[_](e)))if(t&&E(t)){for(r=l[e],i=r.handlers.length,n=i-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||M(l,a,e,o)}else M(l,a,e,o)}else if(T(e)&&e.length){e=c+e;for(o in s)if(s[_](o)&&(l=s[o],l[_](e)))if(t&&E(t)){for(r=l[e],i=r.handlers.length,n=i-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||M(l,a,e,o)}else M(l,a,e,o)}return u},fallback:function(e){var t=this;return 1>arguments.length&&(e=!1),(!1===e||null===e||E(e))&&(t._fallback=e),t},route:function(e,t,n){var r,o,l,i,u,a,s,c,f,d,p,h,g,m,P,R,y,b,v=this;if(e){for(n=!1!==n,t=t?t.toLowerCase():"*",r=v._routes.slice(),b=!1,s=r.length,a=0;s>a;a++)if(o=r[a],(t===o.method||"*"===o.method)&&(o.isParsed||o.parse(),d=o.literal?o.pattern===e?[]:null:e.match(o.pattern),null!=d)){for(b=!0,R=o.handlers.slice(0),c=R.length,f=0;c>f;f++)if(y=R[f],!y[3]||!y[4]){if(i=y[1],u=y[2],l={route:e,pattern:o.route,fallback:!1,data:A({},i,!0)},!o.literal)for(p in o.captures)o.captures[_](p)&&(h=o.captures[p],g=h[0],m=h[1],d[g]?u&&u[_](p)&&u[p]?(P=u[p],T(P)&&H.TYPES[_](P)&&(P=H.TYPES[P]),l.data[p]=E(P)?P(d[g]):d[g]):m?(P=m,l.data[p]=E(P)?P(d[g]):d[g]):l.data[p]=d[g]:l.data[_](p)||(l.data[p]=null));y[4]=1,y[0](l)}for(f=o.handlers.length-1;f>=0;f--)y=o.handlers[f],y[3]&&y[4]&&o.handlers.splice(f,1);if(o.handlers.length||M(v._handlers[o.method],v._routes,o.route,o.method),n)return!0}if(b)return!0}return v._fallback?(v._fallback({route:e,pattern:null,fallback:!0,data:null}),!1):!1}},H});