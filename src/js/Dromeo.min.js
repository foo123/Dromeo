/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node/JS
*   @version: 0.5
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r,o="object"==typeof module&&module.exports,i="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:i&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,o){return n.call(e,{AMD:o})}):t in e||(e[t]=r=n.call(e,{})||1)&&i&&define(t,[],function(){return r})}(this,"Dromeo",function(e,t){"use strict";function n(e,t,n){var r=this;r.handlers=[],r.route=e,r.pattern=t,r.captures=n,r.dispose=function(){return r.handlers=null,r.route=null,r.pattern=null,r.captures=null,r}}var r="0.5",o={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},i=/^([a-zA-Z0-9-_]+\|[a-zA-Z0-9-_|]+)$/,l=/\((\d+)\)$/,u=Object.prototype,s=Array.prototype,a=Function.prototype,c=a.call.bind(u.hasOwnProperty),d=a.call.bind(u.toString),h=a.call.bind(s.slice),f="undefined"!=typeof global&&"[object global]"==d(global),p=function(e){return"[object Function]"===d(e)||e instanceof Function},g=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},m=function(e){return e.length>0},_=function(e){return e.replace(/([*+\[\]\(\)?^$\/\\:])/g,"\\$1")},y={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},R=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],b=function(e,t,n){for(var r=y[n||"php"].exec(e),o={},i=14;i--;)r[i]&&(o[R[i]]=r[i]);return"port"in o&&(o.port=parseInt(o.port,10)),t?o[t.replace("PHP_URL_","").toLowerCase()]||null:(o.source&&delete o.source,o)},v=function(e){return decodeURIComponent(""+e)},A=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},P=function(e){return A(e).split("%20").join("+")},q=function(e){var n,r,o,i,l,u,s,a,d,h,f,p,m,_=e.replace(/^&/,"").replace(/&$/,"").split("&"),y=_.length,R={};for(n=0;y>n;n++)if(a=_[n].split("="),d=v(g(a[0])),h=a.length<2?"":v(g(a[1])),r=d.indexOf("\x00"),r>-1&&(d=d.slice(0,r)),d&&"["!==d.charAt(0)){for(p=[],f=0,r=0;r<d.length;r++)if("["!==d.charAt(r)||f){if("]"===d.charAt(r)&&f&&(p.length||p.push(d.slice(0,f-1)),p.push(d.substr(f,r-f)),f=0,"["!==d.charAt(r+1)))break}else f=r+1;for(p.length||(p=[d]),r=0;r<p[0].length&&(s=p[0].charAt(r),(" "===s||"."===s||"["===s)&&(p[0]=p[0].substr(0,r)+"_"+p[0].substr(r+1)),"["!==s);r++);for(u=R,r=0,m=p.length;m>r;r++)if(d=p[r].replace(/^['"]/,"").replace(/['"]$/,""),l=u,""!==d&&" "!==d||0===r)t===u[d]&&(u[d]={}),u=u[d];else{o=-1;for(i in u)c(u,i)&&+i>o&&i.match(/^\d+$/g)&&(o=+i);d=o+1}l[d]=h}return R},N=function(e,t,n,r){var o,i,l=r?A:P;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){i=[];for(o in t)null!=t[o]&&i.push(N(e+"["+o+"]",t[o],n,r));return i.join(n)}return l(e)+"="+l(t)}return""},L=function(e,t,n){var r,o,i,l=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(o in e)r=e[o],i=N(o,r,t,n),""!=i&&l.push(i);return l.join(t)},T=function(e,t,n){if(n){var r,o,i=[];for(e=e.split(t),o=0;o<e.length;o++)r=e[o],r=r.split(n),i.push(r[0]),r.length>1&&i.push(r[1]);return i}return e.split(t)},w=function(e,t,n){var r,o,l,u,s,a=0;for(n=T(n,e[3]),u=[],o=n.length,l=!1,r=0;o>r;r++)l?(n[r].length&&(t[n[r]]?(u.push("("+t[n[r]]+")"),a++):(s=n[r].match(i))?(u.push("("+s[1].split("|").filter(m).map(_).join("|")+")"),a++):u.push(_(n[r]))),l=!1):(n[r].length&&u.push(_(n[r])),l=!0);return 1===u.length&&1===a?[u.join(""),a]:["("+u.join("")+")",a+1]},j=function(e,t,r){var o,i,u,s,a,c,d,h,f,p,m,y,R,b,v;for(o=T(r,e[0],e[1]),s=o.length,d=!1,h="",m=0,y={},u=0;s>u;u++)i=o[u],d?(a=!1,c=!1,f=i.split(e[2]),b=w(e,t,f[0]),f.length>1&&(R=g(f[1]),a=R.length&&"?"===R.charAt(0),a&&(R=R.slice(1)),(p=R.match(l))?(R=R.slice(0,-p[0].length),v=parseInt(p[1],10),v>=0&&v<b[1]?v+=m+1:v=m+1):v=m+1,c=R.length>0),h+=b[0],m+=b[1],a&&(h+="?"),c&&(y[R]=v),d=!1):(h+=_(i),d=!0);return new n(r,new RegExp("^"+h+"$"),y)},k=function(e,t,n){delete e[n];var r,o=t.length;for(r=o-1;r>=0;r--)if(n===t[r].route){t.splice(r,1);break}},C=function(e,t,n,r,o,i,l,u){o&&o.length&&i&&"function"==typeof i&&(u=!0===u,l=l||{},o in e?e[o].handlers.push([i,l,u]):(e[o]=j(n,r,o),e[o].handlers.push([i,l,u]),t.push(e[o])))},x=function(){var e=this;e._delims=["{","}",":","%"],e._patterns={},e.definePattern("ALPHA","[a-zA-Z\\-_]+"),e.definePattern("NUMBR","[0-9]+"),e.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),e.definePattern("QUERY","\\?[^?#]+"),e.definePattern("FRAGM","#[^?#]+"),e.definePattern("ALL",".+"),e._handlers=[],e._routes=[],e._fallback=!1};return x.VERSION=r,x.Route=n,x.prototype={constructor:x,_delims:null,_patterns:null,_handlers:null,_routes:null,_fallback:!1,dispose:function(){var e,t=this;t._delims=null,t._patterns=null,t._routes=null,t._fallback=null;for(e in t._handlers)t._handlers[e].dispose();return t._handlers=null,t},reset:function(){return this._handlers={},this._routes=[],this._fallback=!1,this},defineDelimiters:function(e){var t,n=this;return e&&(t=e.length,t>0&&e[0]&&(n._delims[0]=e[0]),t>1&&e[1]&&(n._delims[1]=e[1]),t>2&&e[2]&&(n._delims[2]=e[2]),t>3&&e[3]&&(n._delims[3]=e[3])),n},definePattern:function(e,t){return this._patterns[e]=t,this},dropPattern:function(e){return e in this._patterns&&delete this._patterns[e],this},parse:function(e,t,n){var r={};return e&&(arguments.length<3&&(n="fragment_params"),arguments.length<2&&(t="query_params"),r=b(e),t&&(r[t]=r.query?this.unglue(r.query):{}),n&&(r[n]=r.fragment?this.unglue(r.fragment):{})),r},unglue:function(e){var t;return t=e?q(e):{}},build:function(e,t,n,r,o){var i=""+e;return arguments.length<5&&(o="#"),arguments.length<4&&(r="?"),t&&(i+=r+this.glue(t)),n&&(i+=o+this.glue(n)),i},glue:function(e){var t="";return e&&(t+=L(e,"&",!0)),t},redirect:function(e,t,n,r){return e&&(f?t&&(arguments.length<3&&(n=302),arguments.length<4&&(r=!0),r?(!0===r&&(r=o[n]||""),t.writeHead(n,r,{Location:e})):t.writeHead(n,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e,t,n,r=this,o=h(arguments),i=o.length;if(i>=2)e=o,n=e[2]||null,C(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n);else if(1===i&&o[0]instanceof Array)for(o=o[0],i=o.length,t=0;i>t;t++)e=o[t],e.length>=2&&(n=e[2]||null,C(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n));return r},one:function(){var e,t,n,r=this,o=h(arguments),i=o.length;if(i>=2)e=o,n=e[2]||null,C(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n,!0);else if(1===i&&o[0]instanceof Array)for(o=o[0],i=o.length,t=0;i>t;t++)e=o[t],e.length>=2&&(n=e[2]||null,C(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n,!0));return r},off:function(e,t){var n,r,o,i=this,l=i._routes,u=i._handlers;if(e&&e in u)if(t&&p(t)){for(r=u[e],o=r.handlers.length,n=o-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||k(u,l,e)}else k(u,l,e);return i},fallback:function(e){return 1>arguments.length&&(e=!1),(!1===e||null===e||p(e))&&(this._fallback=e),this},route:function(e){var t,n,r,o,i,l,u,s,a,c,d,h,f=this,p=f._routes;if(e)for(o=p.length,r=0;o>r;r++)if(t=p[r],u=e.match(t.pattern)){for(c=t.handlers.slice(0),h=[],i=c.length,l=0;i>l;l++)c[l][2]&&h.push(l);for(i=h.length;--i>=0;)t.handlers.splice(h.pop(),1);for(i=c.length,l=0;i>l;l++){d=c[l],n={};for(s in t.captures)a=t.captures[s],n[s]=u[a]?u[a]:s in d[1]?d[1][s]:null;d[0](e,n)}return!0}return f._fallback?(f._fallback(e,!1),!1):!1}},x});