/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node/XPCOM/JS
*   @version: 1.0.0
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}(this,"Dromeo",function(e){"use strict";function t(e,t,n,r){var o=this;o.__args__=[e,t],o.isParsed=!1,o.handlers=[],o.route=n,o.method=r,o.pattern=null,o.captures=null,o.literal=!1,o.namespace=null,o.parse=function(){if(o.isParsed)return o;var e=x(o.__args__[0],o.__args__[1],o.route,o.method);return o.pattern=e[1],o.captures=e[2],o.literal=!0===e[4],o.__args__=null,o.isParsed=!0,o},o.dispose=function(){return o.__args__=null,o.isParsed=null,o.handlers=null,o.route=null,o.pattern=null,o.captures=null,o.method=null,o.literal=null,o.namespace=null,o}}var n={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},r=/^([^|]+\|.+)$/,o=/\((\d+)\)$/,l=/^\s+|\s+$/g,i=/([*+\[\]\(\)?^$\/\\:.])/g,u="prototype",a=Object[u],s=(Array[u],Function[u],a.toString),c=a.hasOwnProperty,f="undefined"!=typeof global&&"[object global]"==s.call(global),d=function(e){return e instanceof Array||"[object Array]"===s.call(e)},p=function(e){return e instanceof Object||"[object Object]"===s.call(e)},h=function(e){return e instanceof String||"[object String]"===s.call(e)},g=function(e){return e instanceof Number||"[object Number]"===s.call(e)},m=function(e){return"function"==typeof e},_=String[u].trim?function(e){return e.trim()}:function(e){return e.replace(l,"")},P=function(e){return e.length>0},R=function(e){return e.replace(i,"\\$1")},T=function(e,t,n){var r,o;if(n=!0===n,t)for(r in t)c.call(t,r)&&(o=t[r],g(o)?e[r]=0+o:h(o)?e[r]=o.slice():d(o)?e[r]=n?T(new Array(o.length),o,n):o:p(o)?e[r]=n?T({},o,n):o:e[r]=o);return e},y={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},b=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],E=function(e,t,n){for(var r=y[n||"php"].exec(e),o={},l=14;l--;)r[l]&&(o[b[l]]=r[l]);return c.call(o,"port")&&(o.port=parseInt(o.port,10)),t?o[t.replace("PHP_URL_","").toLowerCase()]||null:(o.source&&delete o.source,o)},S=function(e){return decodeURIComponent(""+e)},v=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},A=function(e){return S((""+e).split("+").join("%20"))},N=function(e){return v(e).split("%20").join("+")},C=function(t){var n,r,o,l,i,u,a,s,f,d,p,h,g,m=t.replace(/^&/,"").replace(/&$/,"").split("&"),P=m.length,R={};for(n=0;n<P;n++)if(s=m[n].split("="),f=S(_(s[0])),d=s.length<2?"":S(_(s[1])),(r=f.indexOf("\0"))>-1&&(f=f.slice(0,r)),f&&"["!==f.charAt(0)){for(h=[],p=0,r=0;r<f.length;r++)if("["!==f.charAt(r)||p){if("]"===f.charAt(r)&&p&&(h.length||h.push(f.slice(0,p-1)),h.push(f.substr(p,r-p)),p=0,"["!==f.charAt(r+1)))break}else p=r+1;for(h.length||(h=[f]),r=0;r<h[0].length&&(" "!==(a=h[0].charAt(r))&&"."!==a&&"["!==a||(h[0]=h[0].substr(0,r)+"_"+h[0].substr(r+1)),"["!==a);r++);for(u=R,r=0,g=h.length;r<g;r++)if(f=h[r].replace(/^['"]|['"]$/g,""),i=u,""!==f&&" "!==f||0===r)e===u[f]&&(u[f]={}),u=u[f];else{o=-1;for(l in u)c.call(u,l)&&+l>o&&l.match(/^\d+$/g)&&(o=+l);f=o+1}i[f]=d}return R},L=function(e,t,n){var r,o=t.length;if(!0===n){for(r=0;r<o;r++)if(e===t[r])return!0}else for(r=0;r<o;r++)if(e==t[r])return!0;return!1},j=function(e,t,n,r){var o,l,i=r?v:N;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){l=[];for(o in t)c.call(t,o)&&null!=t[o]&&l.push(j(e+"["+o+"]",t[o],n,r));return l.join(n)}return i(e)+"="+i(t)}return""},q=function(e,t,n){var r,o,l,i=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(o in e)c.call(e,o)&&(r=e[o],""!=(l=j(o,r,t,n))&&i.push(l));return i.join(t)},w=function(e,t,n){if(n){var r,o,l=[];for(e=e.split(t),o=0;o<e.length;o++)r=(r=e[o]).split(n),l.push(r[0]),r.length>1&&l.push(r[1]);return l}return e.split(t)},I=function(e,t,n){var o,l,i,u,a,s=0,f={};for(u=[],l=(n=w(n,e[2],e[3])).length,i=!1,o=0;o<l;o++)i?(n[o].length&&(c.call(t,n[o])?(u.push("("+t[n[o]][0]+")"),s++,t[n[o]][1]&&(f[s]=t[n[o]][1])):(a=n[o].match(r))?(u.push("("+a[1].split("|").filter(P).map(R).join("|")+")"),s++):n[o].length&&(u.push("("+R(n[o])+")"),s++)),i=!1):(n[o].length&&u.push(R(n[o])),i=!0);return 1===u.length&&1===s?(f[0]=f[1]?f[1]:null,[u.join(""),s,f]):(f[0]=null,["("+u.join("")+")",s+1,f])},x=function(e,t,n,r){var l,i,u,a,s,f,d,p,h,g,m,P,T,y,b,E;if(0>n.indexOf(e[0]))return[n,n,{},r,!0];for(a=(l=w(n,e[0],e[1])).length,d=!1,p="",m=0,T={},u=0;u<a;u++)i=l[u],d?(s=!1,f=!1,P=null,(h=i.split(e[4]))[0].length||(h[0]="%PART%"),b=I(e,t,h[0]),h.length>1&&((s=(y=_(h[1])).length&&"?"===y.charAt(0))&&(y=y.slice(1)),(g=y.match(o))?(y=y.slice(0,-g[0].length),E=parseInt(g[1],10),P=c.call(b[2],E)?b[2][E]:null,E>=0&&E<b[1]?E+=m+1:E=m+1):(P=b[2][0]?b[2][0]:null,E=m+1),f=y.length>0),p+=b[0],m+=b[1],s&&(p+="?"),f&&(T[y]=[E,P]),d=!1):(p+=R(i),d=!0);return[n,new RegExp("^"+p+"$"),T,r,!1]},k=function(e,t){var n;for(n=e.length-1;n>=0;n--)t===e[n].route&&(e[n].dispose(),e.splice(n,1))},U=function(e,n,r,o,l,i){if(l&&h(l.route)&&l.route.length&&l.handler&&m(l.handler)){i=!0===i;var u,a,s,c=l.handler,f=l.defaults||{},d=l.types||null,p=l.method?l.method.map?l.method.map(function(e){return e.toLowerCase()}):[l.method.toLowerCase()]:["*"];for(l=o+l.route,L("*",p)&&(p=["*"]),u=null,a=0,s=e.length;a<s;a++)if(l===e[a].route){u=e[a];break}u||(u=new t(n,r,l,p),e.push(u)),u.handlers.push([c,f,d,i,0])}},Y=function(e,t,n,r,o,l){var i,u;for(l=!!l,u=0;u<o.length;u++)i=o[u],U(e,t,n,r,i,l)},D=function e(t){var n=this;if(!(n instanceof e))return new e(t);n._delims=["{","}","%","%",":"],n._patterns={},n.definePattern("ALPHA","[a-zA-Z\\-_]+"),n.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),n.definePattern("NUMBR","[0-9]+"),n.definePattern("INT","[0-9]+","INT"),n.definePattern("PART","[^\\/?#]+"),n.definePattern("VAR","[^=?&#\\/]+","VAR"),n.definePattern("QUERY","\\?[^?#]+"),n.definePattern("FRAGMENT","#[^?#]+"),n.definePattern("URLENCODED","[^\\/?#]+","URLENCODED"),n.definePattern("ALL",".+"),n._routes=[],n._fallback=!1,n._prefix=null!=t?String(t):""};return D.VERSION="1.0.0",D.Route=t,D.TYPES={INTEGER:function(e){return parseInt(e,10)||0},STRING:function(e){return h(e)?e:""+String(e)},URLDECODE:function(e){return A(e)},ARRAY:function(e){return d(e)?e:[e]},PARAMS:function(e){return h(e)?D.unglue_params(e):e}},D.TYPES.INT=D.TYPES.INTEGER,D.TYPES.STR=D.TYPES.STRING,D.TYPES.VAR=D.TYPES.URLDECODE,D.TYPES.URLENCODED=D.TYPES.PARAMS,D.glue_params=function(e){var t="";return e&&(t+=q(e,"&",!0)),t},D.unglue_params=function(e){return e?C(e):{}},D.parse_components=function(e,t,n){var r=this,o={};return e&&(arguments.length<3&&(n="fragment_params"),arguments.length<2&&(t="query_params"),o=E(e),t&&(o.query?o[t]=r.unglue_params(o.query):o[t]={}),n&&(o.fragment?o[n]=r.unglue_params(o.fragment):o[n]={})),o},D.build_components=function(e,t,n,r,o){var l=this,i=""+e;return arguments.length<5&&(o="#"),arguments.length<4&&(r="?"),t&&(i+=r+l.glue_params(t)),n&&(i+=o+l.glue_params(n)),i},D.defType=function(e,t){e&&m(t)&&(D.TYPES[e]=t)},D.TYPE=function(e){return e&&c.call(D.TYPES,e)?D.TYPES[e]:null},D[u]={constructor:D,_delims:null,_patterns:null,_routes:null,_fallback:!1,_prefix:"",dispose:function(){var e,t,n=this;if(n._delims=null,n._patterns=null,n._fallback=null,n._prefix=null,n._routes)for(e=0,t=n._routes.length;e<t;e++)n._routes[e].dispose();return n._routes=null,n},reset:function(){var e=this;return e._routes=[],e._fallback=!1,e},defineDelimiters:function(e){var t,n=this,r=n._delims;return e&&((t=e.length)>0&&e[0]&&(r[0]=e[0]),t>1&&e[1]&&(r[1]=e[1]),t>2&&e[2]&&(r[2]=e[2]),t>3&&e[3]&&(r[3]=e[3]),t>4&&e[4]&&(r[4]=e[4])),n},definePattern:function(e,t,n){var r=this;return n&&h(n)&&n.length&&c.call(D.TYPES,n)&&(n=D.TYPES[n]),n&&m(n)||(n=null),r._patterns[e]=[t,n],r},dropPattern:function(e){var t=this,n=t._patterns;return c.call(n,e)&&delete n[e],t},defineType:function(e,t){return D.defType(e,t),this},glue:function(e){return D.glue_params(e)},unglue:function(e){return D.unglue_params(e)},parse:function(e,t,n){return D.parse_components(e,t,n)},build:function(e,t,n,r,o){return D.build_components(e,t,n,r,o)},redirect:function(e,t,r,o){return e&&(f?t&&(arguments.length<3&&(r=302),arguments.length<4&&(o=!0),o?(!0===o&&(o=n[r]||""),t.writeHead(r,o,{Location:e})):t.writeHead(r,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?d(n[0])?n[0]:[n[0]]:2===r&&h(n[0])&&m(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,Y(t._routes,t._delims,t._patterns,t._prefix,e),t},one:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?d(n[0])?n[0]:[n[0]]:2===r&&h(n[0])&&m(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,Y(t._routes,t._delims,t._patterns,t._prefix,e,!0),t},off:function(e,t){var n,r,o,l=this,i=l._routes,u=l._prefix;if(!e)return l;if(p(e)){if(t=e.handler||t,!(e=e.route))return l;for(e=u+e,r=null,n=0,o=i.length;n<o;n++)if(e===i[n].route){r=i[n];break}if(!r)return l;if(t&&m(t)){for(n=(o=r.handlers.length)-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||k(i,e)}else k(i,e)}else if(h(e)&&e.length){for(e=u+e,r=null,n=0,o=i.length;n<o;n++)if(e===i[n].route){r=i[n];break}if(!r)return l;if(t&&m(t)){for(n=(o=r.handlers.length)-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||k(i,e)}else k(i,e)}return l},fallback:function(e){var t=this;return 1>arguments.length&&(e=!1),(!1===e||null===e||m(e))&&(t._fallback=e),t},route:function(e,t,n){var r,o,l,i,u,a,s,f,d,p,g,_,P,R,y,b,E,S,v=this;if(e){for(n=!1!==n,t=t?String(t).toLowerCase():"*",S=!1,s=(r=v._routes.slice()).length,a=0;a<s;a++)if(o=r[a],(L(t,o.method)||"*"===o.method[0])&&(o.isParsed||o.parse(),null!=(p=o.literal?o.pattern===e?[]:null:e.match(o.pattern)))){for(S=!0,f=(b=o.handlers.slice(0)).length,d=0;d<f;d++)if(!(E=b[d])[3]||!E[4]){if(i=E[1],u=E[2],l={route:e,method:t,pattern:o.route,fallback:!1,data:T({},i,!0)},!o.literal)for(g in o.captures)c.call(o.captures,g)&&(P=(_=o.captures[g])[0],R=_[1],p[P]?u&&c.call(u,g)&&u[g]?(y=u[g],h(y)&&c.call(D.TYPES,y)&&(y=D.TYPES[y]),l.data[g]=m(y)?y(p[P]):p[P]):R?(y=R,l.data[g]=m(y)?y(p[P]):p[P]):l.data[g]=p[P]:c.call(l.data,g)||(l.data[g]=null));E[4]=1,E[0](l)}if(n)return!0}if(S)return!0}return!!v._fallback&&(v._fallback({route:e,pattern:null,fallback:!0,data:null}),!1)}},D});