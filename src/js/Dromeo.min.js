/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node.js / Browser / XPCOM Javascript
*   @version: 1.1.0
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}("undefined"!=typeof self?self:this,"Dromeo",function(e){"use strict";function t(e,t,n,r,l,o){var u=this;u.__args__=[e,t],u.isParsed=!1,u.handlers=[],u.route=String(n),u.prefix=String(o),u.method=r,u.pattern=null,u.captures=null,u.literal=!1,u.namespace=null,u.tpl=null,u.name=l||null}function n(e){var t=this;if(!(t instanceof n))return new n(e);t._delims=["{","}","%","%",":"],t._patterns={},t.definePattern("ALPHA","[a-zA-Z\\-_]+"),t.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),t.definePattern("NUMBR","[0-9]+"),t.definePattern("INT","[0-9]+","INT"),t.definePattern("PART","[^\\/?#]+"),t.definePattern("VAR","[^=?&#\\/]+","VAR"),t.definePattern("QUERY","\\?[^?#]+"),t.definePattern("FRAGMENT","#[^?#]+"),t.definePattern("URLENCODED","[^\\/?#]+","URLENCODED"),t.definePattern("ALL",".+"),t._routes=[],t._named_routes={},t._fallback=!1,t._prefix=null!=e?String(e):""}var r={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},l=/^([^|]+\|.+)$/,o=/\((\d+)\)$/,u=/^\s+|\s+$/g,a=/([*+\[\]\(\)?^$\/\\:.])/g,i="prototype",s=Object[i],c=(Array[i],Function[i],s.toString),f=s.hasOwnProperty,p="undefined"!=typeof global&&"[object global]"==c.call(global),d=function(e){return e instanceof Array||"[object Array]"===c.call(e)},h=function(e){return"[object Object]"===c.call(e)},m=function(e){return e instanceof String||"[object String]"===c.call(e)},g=function(e){return e instanceof Number||"[object Number]"===c.call(e)},_=function(e){return"function"==typeof e},P=String[i].trim?function(e){return e.trim()}:function(e){return e.replace(u,"")},T=function(e){return e.length>0},R=function(e){return e.replace(a,"\\$1")},E=function(e,t,n){var r,l;if(n=!0===n,t)for(r in t)f.call(t,r)&&(l=t[r],g(l)?e[r]=0+l:m(l)?e[r]=l.slice():d(l)?e[r]=n?E(new Array(l.length),l,n):l:h(l)?e[r]=n?E({},l,n):l:e[r]=l);return e},y={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},S=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],b=function(e,t,n){for(var r=y[n||"php"].exec(e),l={},o=14;o--;)r[o]&&(l[S[o]]=r[o]);return f.call(l,"port")&&(l.port=parseInt(l.port,10)),t?l[t.replace("PHP_URL_","").toLowerCase()]||null:(l.source&&delete l.source,l)},v=function(e){return decodeURIComponent(""+e)},A=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},N=function(e){return v((""+e).split("+").join("%20"))},x=function(e){return A(e).split("%20").join("+")},C=function(t){var n,r,l,o,u,a,i,s,c,f,p,d=t.replace(/^&/,"").replace(/&$/,"").split("&"),h=d.length,m={};for(n=0;n<h;n++)if(a=d[n].split("="),i=v(P(a[0])),s=a.length<2?"":v(P(a[1])),(r=i.indexOf("\0"))>-1&&(i=i.slice(0,r)),i&&"["!==i.charAt(0)){for(f=[],c=0,r=0;r<i.length;r++)if("["!==i.charAt(r)||c){if("]"===i.charAt(r)&&c&&(f.length||f.push(i.slice(0,c-1)),f.push(i.substr(c,r-c)),c=0,"["!==i.charAt(r+1)))break}else c=r+1;for(f.length||(f=[i]),r=0;r<f[0].length&&(" "!==(u=f[0].charAt(r))&&"."!==u&&"["!==u||(f[0]=f[0].substr(0,r)+"_"+f[0].substr(r+1)),"["!==u);r++);for(o=m,r=0,p=f.length;r<p;r++)l=o,""!==(i=f[r].replace(/^['"]|['"]$/g,""))&&" "!==i||0===r?(e===o[i]&&(o[i]=r+1!==p-1||""!==f[r+1]&&" "!==f[r+1]?{}:[]),o=o[i]):i=!0;!0===i?l.push(s):l[i]=s}return m},w=function(e,t,n){var r,l=t.length;if(!0===n){for(r=0;r<l;r++)if(e===t[r])return!0}else for(r=0;r<l;r++)if(e==t[r])return!0;return!1},L=function(e,t,n,r){var l,o,u=r?A:x;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){o=[];for(l in t)f.call(t,l)&&null!=t[l]&&o.push(L(e+"["+l+"]",t[l],n,r));return o.join(n)}return u(e)+"="+u(t)}return""},q=function(e,t,n){var r,l,o,u=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(l in e)f.call(e,l)&&(r=e[l],""!=(o=L(l,r,t,n))&&u.push(o));return u.join(t)},j=function(e,t,n){if(t!==n&&n){var r,l,o=[];for(e=e.split(t),l=0;l<e.length;l++)r=(r=e[l]).split(n),o.push(r[0]),r.length>1&&o.push(r[1]);return o}return e.split(t)},k=function(e,t,n){var r,o,u,a,i,s,c,p,d=0,h={};for(a=[],s=[],c=null,o=(n=j(n,e[2],e[3])).length,u=!1,r=0;r<o;r++)u?(n[r].length&&(f.call(t,n[r])?(a.push("("+t[n[r]][0]+")"),d++,t[n[r]][1]&&(h[d]=t[n[r]][1]),null===c&&(c=a[a.length-1])):(i=n[r].match(l))?(a.push("("+i[1].split("|").filter(T).map(R).join("|")+")"),d++,null===c&&(c=a[a.length-1])):n[r].length&&(a.push("("+R(n[r])+")"),d++,null===c&&(c=a[a.length-1]))),s.push(!0),u=!1):(n[r].length&&(a.push(R(n[r])),s.push(n[r])),u=!0);return 1===a.length&&1===d?(h[0]=h[1]?h[1]:null,p=a.join(""),[p,d,h,s,c||p]):(h[0]=null,p="("+a.join("")+")",[p,d+1,h,s,c||p])},I=function(e,t,n,r,l){var u,a,i,s,c,p,d,h,m,g,_,T,E,y,S,b,v,A;if(0>n.indexOf(e[0]))return[n,n,{},r,!0,[l&&l.length?n.slice(l.length):n]];for(s=(u=j(n,e[0],e[1])).length,d=!1,h="",_=0,E={},v=[],A=!1,i=0;i<s;i++)a=u[i],d?(c=!1,p=!1,T=null,(m=a.split(e[4]))[0].length||(m[0]=e[2]+"PART"+e[3]),S=k(e,t,m[0]),m.length>1&&((c=(y=P(m[1])).length&&"?"===y.charAt(0))&&(y=y.slice(1)),(g=y.match(o))?(y=y.slice(0,-g[0].length),b=parseInt(g[1],10),T=f.call(S[2],b)?S[2][b]:null,b>=0&&b<S[1]?b+=_+1:b=_+1):(T=S[2][0]?S[2][0]:null,b=_+1),p=y.length>0),h+=S[0],_+=S[1],c&&(h+="?"),p&&(E[y]=[b,T]),p&&v.push({name:y,optional:c,re:new RegExp("^"+S[4]+"$"),tpl:S[3]}),d=!1):(h+=R(a),A||(A=!0,l&&l.length&&(a=a.slice(l.length))),v.push(a),d=!0);return[n,new RegExp("^"+h+"$"),E,r,!1,v]},U=function(e,t,n){var r;for(r=e.length-1;r>=0;r--)n===e[r].route&&(n.name&&f.call(t,n.name)&&delete t[n.name],e[r].dispose(),e.splice(r,1))},Y=function(e,n,r,l,o,u,a){if(u&&m(u.route)&&u.route.length&&u.handler&&_(u.handler)){a=!0===a;var i,s,c,f=u.handler,p=u.defaults||{},d=u.types||null,h=u.name||null,g=u.method?u.method.map?u.method.map(function(e){return e.toLowerCase()}):[u.method.toLowerCase()]:["*"];for(u=o+u.route,w("*",g)&&(g=["*"]),i=null,s=0,c=e.length;s<c;s++)if(u===e[s].route){i=e[s];break}i||(i=new t(r,l,u,g,h,o),e.push(i),i.name&&i.name.length&&(n[i.name]=i)),i.handlers.push([f,p,d,a,0])}},D=function(e,t,n,r,l,o,u){var a,i;for(u=!!u,i=0;i<o.length;i++)a=o[i],Y(e,t,n,r,l,a,u)};return t[i]={constructor:t,__args__:null,isParsed:!1,handlers:null,route:null,prefix:null,pattern:null,captures:null,tpl:null,method:null,literal:null,namespace:null,name:null,dispose:function(){var e=this;return e.__args__=null,e.isParsed=null,e.handlers=null,e.route=null,e.prefix=null,e.pattern=null,e.captures=null,e.tpl=null,e.method=null,e.literal=null,e.namespace=null,e.name=null,e},parse:function(){var e=this;if(e.isParsed)return e;var t=I(e.__args__[0],e.__args__[1],e.route,e.method,e.prefix);return e.pattern=t[1],e.captures=t[2],e.tpl=t[5],e.literal=!0===t[4],e.__args__=null,e.isParsed=!0,e},make:function(e,t){var n,r,l,o,u,a,i,s=this,c="",p=s.prefix&&s.prefix.length?s.route.slice(s.prefix.length):s.route;for(e=e||{},t=!0===t,s.isParsed||s.parse(),n=0,r=(i=s.tpl).length;n<r;n++)if(m(i[n]))c+=i[n];else{if(!f.call(e,i[n].name)||null==e[i[n].name]){if(i[n].optional)continue;throw new ReferenceError('Dromeo: Route "'+s.name+'" (PATTERN: "'+p+'") missing parameter "'+i[n].name+'"!')}if(u=String(e[i[n].name]),t&&!i[n].re.test(u))throw new ReferenceError('Dromeo: Route "'+s.name+'" (PATTERN: "'+p+'") parameter "'+i[n].name+'" value "'+u+'" does not match pattern!');for(l=0,o=(a=i[n].tpl).length;l<o;l++)c+=!0===a[l]?u:a[l]}return c}},n.VERSION="1.1.0",n.HTTP_STATUS=r,n.Route=t,n.TYPES={INTEGER:function(e){return parseInt(e,10)||0},STRING:function(e){return m(e)?e:""+String(e)},URLDECODE:function(e){return N(e)},ARRAY:function(e){return d(e)?e:[e]},PARAMS:function(e){return m(e)?n.unglue_params(e):e}},n.TYPES.INT=n.TYPES.INTEGER,n.TYPES.STR=n.TYPES.STRING,n.TYPES.VAR=n.TYPES.URLDECODE,n.TYPES.URLENCODED=n.TYPES.PARAMS,n.glue_params=function(e){var t="";return e&&(t+=q(e,"&",!0)),t},n.unglue_params=function(e){return e?C(e):{}},n.parse_components=function(e,t,n){var r=this,l={};return e&&((arguments.length<3||null==n)&&(n="fragment_params"),(arguments.length<2||null==t)&&(t="query_params"),l=b(e),t&&(l.query?l[t]=r.unglue_params(l.query):l[t]={}),n&&(l.fragment?l[n]=r.unglue_params(l.fragment):l[n]={})),l},n.build_components=function(e,t,n,r,l){var o=this,u=""+e;return(arguments.length<5||null==l)&&(l="#"),(arguments.length<4||null==r)&&(r="?"),t&&(u+=r+o.glue_params(t)),n&&(u+=l+o.glue_params(n)),u},n.defType=function(e,t){e&&_(t)&&(n.TYPES[e]=t)},n.TYPE=function(e){return e&&f.call(n.TYPES,e)?n.TYPES[e]:null},n[i]={constructor:n,_delims:null,_patterns:null,_routes:null,_named_routes:null,_fallback:!1,_prefix:"",dispose:function(){var e,t,n=this;if(n._delims=null,n._patterns=null,n._fallback=null,n._prefix=null,n._routes)for(e=0,t=n._routes.length;e<t;e++)n._routes[e].dispose();return n._routes=null,n._named_routes=null,n},reset:function(){var e=this;return e._routes=[],e._named_routes={},e._fallback=!1,e},defineDelimiters:function(e){var t,n=this,r=n._delims;return e&&((t=e.length)>0&&e[0]&&(r[0]=e[0]),t>1&&e[1]&&(r[1]=e[1]),t>2&&e[2]&&(r[2]=e[2]),t>3&&e[3]&&(r[3]=e[3]),t>4&&e[4]&&(r[4]=e[4])),n},definePattern:function(e,t,r){var l=this;return r&&m(r)&&r.length&&f.call(n.TYPES,r)&&(r=n.TYPES[r]),r&&_(r)||(r=null),l._patterns[e]=[t,r],l},dropPattern:function(e){var t=this,n=t._patterns;return f.call(n,e)&&delete n[e],t},defineType:function(e,t){return n.defType(e,t),this},glue:function(e){return n.glue_params(e)},unglue:function(e){return n.unglue_params(e)},parse:function(e,t,r){return n.parse_components(e,t,r)},build:function(e,t,r,l,o){return n.build_components(e,t,r,l,o)},redirect:function(e,t,r,l){return e&&(p?t&&(arguments.length<3&&(r=302),arguments.length<4&&(l=!0),l?(!0===l&&(l=n.HTTP_STATUS[r]||""),t.writeHead(r,l,{Location:e})):t.writeHead(r,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?d(n[0])?n[0]:[n[0]]:2===r&&m(n[0])&&_(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,D(t._routes,t._named_routes,t._delims,t._patterns,t._prefix,e),t},one:function(){var e,t=this,n=arguments,r=n.length;return e=1===r?d(n[0])?n[0]:[n[0]]:2===r&&m(n[0])&&_(n[1])?[{route:n[0],handler:n[1],method:"*",defaults:{},types:null}]:n,D(t._routes,t._named_routes,t._delims,t._patterns,t._prefix,e,!0),t},off:function(e,t){var n,r,l,o=this,u=o._routes,a=o._named_routes,i=o._prefix;if(!e)return o;if(h(e)){if(t=e.handler||t,!(e=e.route))return o;for(e=i+e,r=null,n=0,l=u.length;n<l;n++)if(e===u[n].route){r=u[n];break}if(!r)return o;if(t&&_(t)){for(n=(l=r.handlers.length)-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||U(u,a,e)}else U(u,a,e)}else if(m(e)&&e.length){for(e=i+e,r=null,n=0,l=u.length;n<l;n++)if(e===u[n].route){r=u[n];break}if(!r)return o;if(t&&_(t)){for(n=(l=r.handlers.length)-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||U(u,a,e)}else U(u,a,e)}return o},fallback:function(e){var t=this;return 1>arguments.length&&(e=!1),(!1===e||null===e||_(e))&&(t._fallback=e),t},make:function(e,t,n){var r=this._named_routes;return f.call(r,e)?r[e].make(t,n):null},route:function(e,t,r){var l,o,u,a,i,s,c,p,d,h,g,P,T,R,y,S,b,v,A=this;if(e){for(r=!1!==r,t=t?String(t).toLowerCase():"*",v=!1,c=(l=A._routes.slice()).length,s=0;s<c;s++)if(o=l[s],(w(t,o.method)||"*"===o.method[0])&&(o.isParsed||o.parse(),null!=(h=o.literal?o.pattern===e?[]:null:e.match(o.pattern)))){for(v=!0,p=(S=o.handlers.slice(0)).length,d=0;d<p;d++)if(!(b=S[d])[3]||!b[4]){if(a=b[1],i=b[2],u={route:e,method:t,pattern:o.route,fallback:!1,data:E({},a,!0)},!o.literal)for(g in o.captures)f.call(o.captures,g)&&(T=(P=o.captures[g])[0],R=P[1],h[T]?i&&f.call(i,g)&&i[g]?(y=i[g],m(y)&&f.call(n.TYPES,y)&&(y=n.TYPES[y]),u.data[g]=_(y)?y(h[T]):h[T]):R?(y=R,u.data[g]=_(y)?y(h[T]):h[T]):u.data[g]=h[T]:f.call(u.data,g)||(u.data[g]=null));b[4]=1,b[0](u)}if(r)return!0}if(v)return!0}return!!A._fallback&&(A._fallback({route:e,pattern:null,fallback:!0,data:null}),!1)}},n});